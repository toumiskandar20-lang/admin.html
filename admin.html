<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>

<script type="module">
import { initializeApp } from
"https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

import {
  getFirestore,
  collection,
  getDocs,
  query,
  where,
  updateDoc,
  doc
} from
"https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyBfMUa-8vsUZ_1r5F79iSKOKqMre99lwbI",
  authDomain: "maliapp-63f91.firebaseapp.com",
  projectId: "maliapp-63f91"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ================= LOAD MATCHES ================= */
const matchesBox = document.getElementById("matches");

async function loadMatches(){
  matchesBox.innerHTML = "";

  const snap = await getDocs(collection(db,"matches"));

  snap.forEach(docSnap=>{
    const m = docSnap.data();

    matchesBox.innerHTML += `
      <div style="border:1px solid #ccc;padding:10px;margin:10px">
        <b>${m.teamA} vs ${m.teamB}</b><br><br>

        <button onclick="setResult('${docSnap.id}','1')">1</button>
        <button onclick="setResult('${docSnap.id}','X')">X</button>
        <button onclick="setResult('${docSnap.id}','2')">2</button>
      </div>
    `;
  });
}

window.setResult = async (matchId, result)=>{
  // تحديث نتيجة المباراة
  await updateDoc(doc(db,"matches",matchId),{
    result: result
  });

  // تحديث كل الرهانات
  const q = query(
    collection(db,"bets"),
    where("matchId","==",matchId)
  );

  const snap = await getDocs(q);

  snap.forEach(async betSnap=>{
    const bet = betSnap.data();

    const status =
      bet.choice === result ? "win" : "lose";

    await updateDoc(betSnap.ref,{
      status: status
    });
  });

  alert("✅ تم تحديث النتائج");
};

loadMatches();
</script>
</head>

<body>
<h2>لوحة تحكم الأدمن</h2>
<div id="matches"></div>
</body>
</html>
